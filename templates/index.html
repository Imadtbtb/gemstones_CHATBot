<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced Chatbot Information</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    /* Added styles for recording panel */
    .microphone {
      font-size: 60px;
      color: #2d3436;
      cursor: pointer;
      position: relative;
      transition: transform 0.3s ease, color 0.3s ease;
    }

    .microphone.active {
      color: #e74c3c;
      transform: scale(1.2);
    }

    /* Microphone Icon Pulsing Effect */
    .microphone.active::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: rgba(231, 76, 60, 0.3);
      animation: pulsate 1s infinite;
    }

    @keyframes pulsate {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.3);
        opacity: 0.5;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Recording Panel Styling */
    .recording-panel {
      display: none;
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
      text-align: center;
      font-size: 18px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .recording-panel.active {
      display: block;
    }

    .recording-indicator {
      margin-top: 15px;
      font-size: 30px;
      color: red;
      animation: pulsate 1s infinite;
    }

    /* Attach Button Styling */
    .attachment {
      font-size: 25px;
      cursor: pointer;
      position: relative;
      transition: transform 0.3s ease;
    }

    .attachment:hover {
      transform: scale(1.1);
    }

    .file-input {
      display: none;
    }

    /* Stop Recording Button Styling */
    .stop-recording-btn {
      background-color: #e74c3c;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-left: 55px;
      margin-top: 20px;
      display: none;
    }

    .stop-recording-btn:hover {
      background-color: #c0392b;
    }
  </style>
</head>
<body>
  <!-- Chatbot Icon -->
  <div class="chatbot-icon" id="chatbot-icon">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="Chatbot Icon">
  </div>

  <!-- Chat App -->
  <div class="chat-app" id="chat-app" style="display: none;">
    <!-- Header -->
    <div class="chat-header">
      <div class="profile">
        <img src="https://via.placeholder.com/40" alt="User Profile">
        <div class="info">
          <h4>John Doe</h4>
          <p>Online</p>
        </div>
      </div>
      <div class="icons">
        <i class="fas fa-phone-alt"></i>
        <i class="fas fa-video"></i>
        <i class="fas fa-ellipsis-v"></i>
      </div>
    </div>

    <!-- Messages -->
    <div class="chat-messages" id="chat-messages">
      <div class="message received">Hi! How are you?</div>
      <div class="message sent">Iâ€™m good, thanks! How about you?</div>
    </div>

    <!-- Chat Input -->
    <div class="chat-input">
      <i class="fas fa-paperclip attachment" id="attachment-icon"></i>
      <input type="text" id="message-input" placeholder="Type a message">
      <i class="fas fa-microphone microphone" id="microphone-icon"></i>
      <input type="file" id="file-input" class="file-input">
    </div>
  </div>

  <!-- Chatbot Information Container -->
  <div class="chatbot-info-container" id="chatbot-info-container">
    <h2>About My Chatbot</h2>
    <p>This chatbot is designed to provide information about gemstones and help with basic conversations related to gemology. The bot is capable of performing several tasks:</p>
    <ul>
      <li>Identifying different types of gemstones.</li>
      <li>Providing information on their properties, origins, and uses.</li>
      <li>Giving recommendations based on user preferences.</li>
      <li>Chatting about gem-related topics and answering common questions.</li>
    </ul>
    <p>It utilizes Natural Language Processing (NLP) and machine learning to offer accurate and engaging responses to users.</p>
  </div>

  <!-- Enhanced Recording Panel -->
  <div class="recording-panel" id="recording-panel">
    <p>Recording your message...</p>
    <i class="fas fa-microphone recording-indicator"></i>
    <button class="stop-recording-btn" id="stop-recording-btn">Stop Recording</button>
  </div>

  <script>
    const chatbotIcon = document.getElementById('chatbot-icon');
    const chatApp = document.getElementById('chat-app');
    const attachmentIcon = document.getElementById('attachment-icon');
    const microphoneIcon = document.getElementById('microphone-icon');
    const messageInput = document.getElementById('message-input');
    const chatMessages = document.getElementById('chat-messages');
    const chatbotInfoContainer = document.getElementById('chatbot-info-container');
    const recordingPanel = document.getElementById('recording-panel');
    const stopRecordingBtn = document.getElementById('stop-recording-btn');
    const fileInput = document.getElementById('file-input');
    let isRecording = false;
    let mediaRecorder;
    let audioChunks = [];

    // Open chat app when clicking chatbot icon
    chatbotIcon.addEventListener('click', () => {
      chatApp.style.display = 'flex';
      chatbotInfoContainer.style.display = 'none'; // Hide the chatbot info container when chat app is open
      chatbotIcon.style.display = 'none'; // Optionally hide the chatbot icon when the app is open
    });

    // Event listener for sending messages
    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && messageInput.value.trim()) {
        const message = messageInput.value.trim();
        chatMessages.innerHTML += `<div class="message sent">${message}</div>`;
        messageInput.value = '';
      }
    });

    // Start recording when microphone icon is clicked
    microphoneIcon.addEventListener('click', async () => {
      if (!isRecording) {
        startRecording();
      }
    });

    // Stop recording when Stop button is clicked
    stopRecordingBtn.addEventListener('click', stopRecording);

    // Function to start recording
    async function startRecording() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);

        // Record the audio chunks
        mediaRecorder.ondataavailable = (event) => {
          audioChunks.push(event.data);
        };

        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
          const audioUrl = URL.createObjectURL(audioBlob);
          const audio = new Audio(audioUrl);
          audio.play();
        };

        // Start recording
        mediaRecorder.start();
        isRecording = true;

        // Update the UI for recording state
        microphoneIcon.classList.add('active');
        recordingPanel.classList.add('active');
        stopRecordingBtn.style.display = 'block'; // Show the Stop Recording button
      } catch (error) {
        console.error('Error accessing microphone:', error);
      }
    }

    // Function to stop recording
    function stopRecording() {
      mediaRecorder.stop();
      isRecording = false;

      // Update the UI for stopping recording
      microphoneIcon.classList.remove('active');
      recordingPanel.classList.remove('active');
      stopRecordingBtn.style.display = 'none'; // Hide the Stop Recording button
    }

    // Attach file event listener to open file explorer
    attachmentIcon.addEventListener('click', () => {
      fileInput.click(); // Trigger the file input on click
    });

    // Handle file input change (user selects a file)
    fileInput.addEventListener('change', (e) => {
      const fileName = e.target.files[0]?.name;
      if (fileName) {
        const message = `File attached: ${fileName}`;
        chatMessages.innerHTML += `<div class="message sent">${message}</div>`;
      }
    });
  </script>
</body>
</html>
